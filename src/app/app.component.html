@if (showAuthScreen && showSplash) {
    <div class="splash-screen">
        <img
            src="assets/pictures/Logo.svg"
            alt="DA Bubble"
            class="splash-logo"
        />
    </div>
}

@if (showAuthScreen) {
    <main class="auth-page" [class.hidden]="showSplash">
        <header class="page-header">
            <div class="brand">
                <img
                    class="brand-logo"
                    src="assets/pictures/Logo.svg"
                    alt="DA Bubble Logo"
                />
                <span class="brand-name">DABubble</span>
            </div>
            <div class="signup">
                <span>Neu bei DABubble?</span>
                <button
                    type="button"
                    class="link"
                    [disabled]="isSubmitting"
                    (click)="onSubmit('register')"
                >
                    Konto erstellen
                </button>
            </div>
        </header>

        <section class="auth-card" aria-label="Anmeldung">
            <h1>Anmeldung</h1>
            <p class="subtitle">
                Wir empfehlen dir, die E-Mail-Adresse zu nutzen, die du bei der
                Arbeit verwendest.
            </p>

            <form
                [formGroup]="loginForm"
                (ngSubmit)="onSubmit('login')"
                novalidate
            >
                <label class="field" for="email">
                    <span class="icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                            <path
                                d="M4 5h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2zm0 2v.2l8 4.8 8-4.8V7H4zm0 10h16V9.4l-7.5 4.5a1 1 0 0 1-1 0L4 9.4V17z"
                            />
                        </svg>
                    </span>
                    <input
                        id="email"
                        type="email"
                        formControlName="email"
                        placeholder="beispielname@email.com"
                        autocomplete="email"
                    />
                </label>
                @if (emailControl.touched && emailControl.invalid) {
                    <p class="field-error">
                        Bitte gib eine gültige E-Mail-Adresse ein.
                    </p>
                }

                <label class="field" for="password">
                    <span class="icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                            <path
                                d="M17 9h-1V7a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2zm-7-2a2 2 0 1 1 4 0v2h-4V7zm7 12H7v-8h10v8z"
                            />
                        </svg>
                    </span>
                    <input
                        id="password"
                        [type]="showPassword ? 'text' : 'password'"
                        formControlName="password"
                        placeholder="Passwort"
                        autocomplete="current-password"
                    />
                    <button
                        type="button"
                        class="password-toggle"
                        [attr.aria-label]="
                            showPassword
                                ? 'Passwort verbergen'
                                : 'Passwort anzeigen'
                        "
                        [disabled]="isSubmitting"
                        (click)="togglePasswordVisibility()"
                    >
                        <span class="material-symbols-outlined" aria-hidden="true">
                            {{ showPassword ? 'visibility_off' : 'visibility' }}
                        </span>
                    </button>
                </label>
                @if (passwordControl.touched && passwordControl.invalid) {
                    <p class="field-error">
                        Bitte gib dein Passwort ein.
                    </p>
                }

                @if (isRegisterMode) {
                    <div class="password-hints" aria-live="polite">
                        <p>Für „Konto erstellen" gilt:</p>
                        <ul>
                            <li [class.met]="passwordChecks.minLength">
                                Mindestens 8 Zeichen
                            </li>
                            <li [class.met]="passwordChecks.uppercase">
                                Mindestens 1 Großbuchstabe
                            </li>
                            <li [class.met]="passwordChecks.specialChar">
                                Mindestens 1 Sonderzeichen
                            </li>
                        </ul>
                    </div>
                }

                <button
                    type="button"
                    class="link forgot"
                    [disabled]="isSubmitting"
                    (click)="openForgotPasswordOverlay()"
                >
                    Passwort vergessen?
                </button>

                @if (errorMessage) {
                    <p class="message error">{{ errorMessage }}</p>
                }

                @if (successMessage) {
                    <p class="message success">{{ successMessage }}</p>
                }

                <div class="divider">
                    <span></span>
                    <span class="divider-text">ODER</span>
                    <span></span>
                </div>

                <button
                    type="button"
                    class="google"
                    [disabled]="isSubmitting"
                    (click)="onGoogleLogin()"
                >
                    <span class="google-icon" aria-hidden="true">
                        <svg viewBox="0 0 48 48" role="img" aria-hidden="true">
                            <path
                                fill="#EA4335"
                                d="M24 9.5c3.5 0 6.6 1.2 9 3.2l6.7-6.7C35.5 1.9 30.1 0 24 0 14.6 0 6.5 5.4 2.6 13.2l7.8 6C12.4 13.3 17.7 9.5 24 9.5z"
                            />
                            <path
                                fill="#4285F4"
                                d="M46.6 24.5c0-1.6-.1-2.8-.4-4.1H24v7.8h12.8c-.5 3-2.3 5.6-5 7.4l7.7 6c4.6-4.2 7.1-10.4 7.1-17.1z"
                            />
                            <path
                                fill="#FBBC05"
                                d="M10.4 28.6a14.6 14.6 0 0 1 0-9.1l-7.8-6A24 24 0 0 0 0 24c0 3.8.9 7.3 2.6 10.5l7.8-5.9z"
                            />
                            <path
                                fill="#34A853"
                                d="M24 48c6.1 0 11.2-2 15-5.4l-7.7-6c-2.1 1.4-4.8 2.3-7.3 2.3-6.3 0-11.6-3.8-13.6-9.1l-7.8 5.9C6.5 42.6 14.6 48 24 48z"
                            />
                        </svg>
                    </span>
                    Anmelden mit Google
                </button>

                <div class="actions">
                    <button
                        type="submit"
                        class="primary"
                        [disabled]="isSubmitting"
                    >
                        Anmelden
                    </button>
                    <button
                        type="button"
                        class="secondary"
                        [disabled]="isSubmitting"
                        (click)="onGuestLogin()"
                    >
                        Gäste-Login
                    </button>
                </div>
            </form>
        </section>

        <footer class="page-footer">
            <a routerLink="/impressum" class="link">Impressum</a>
            <a routerLink="/datenschutz" class="link">Datenschutz</a>
        </footer>
    </main>
}

@if (showForgotPasswordOverlay) {
    <div class="overlay" (click)="closeForgotPasswordOverlay()">
        <div class="overlay-card" (click)="$event.stopPropagation()">
            <button
                type="button"
                class="close-btn"
                aria-label="Schließen"
                (click)="closeForgotPasswordOverlay()"
            >
                ×
            </button>

            <h2>Passwort zurücksetzen</h2>
            <p class="overlay-subtitle">
                In dem im registrierten Konto hinterlegten Mailkonto kannst du
                dein Passwort ändern. Bitte überprüfe deinen Posteingang.
            </p>

            <form
                [formGroup]="forgotPasswordForm"
                (ngSubmit)="sendPasswordResetEmail()"
                novalidate
            >
                <label class="field" for="reset-email">
                    <span class="icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                            <path
                                d="M4 5h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2zm0 2v.2l8 4.8 8-4.8V7H4zm0 10h16V9.4l-7.5 4.5a1 1 0 0 1-1 0L4 9.4V17z"
                            />
                        </svg>
                    </span>
                    <input
                        id="reset-email"
                        type="email"
                        formControlName="email"
                        placeholder="beispielname@email.com"
                        autocomplete="email"
                    />
                </label>
                @if (
                    forgotPasswordEmailControl.touched &&
                    forgotPasswordEmailControl.invalid
                ) {
                    <p class="field-error">
                        Bitte gib eine gültige E-Mail-Adresse ein.
                    </p>
                }

                @if (forgotPasswordError) {
                    <p class="message error">{{ forgotPasswordError }}</p>
                }

                @if (forgotPasswordMessage) {
                    <p class="message success">{{ forgotPasswordMessage }}</p>
                }

                <button
                    type="submit"
                    class="primary"
                    [disabled]="isSubmitting || forgotPasswordForm.invalid"
                >
                    Reset password
                </button>
            </form>
        </div>
    </div>
}

<router-outlet></router-outlet>

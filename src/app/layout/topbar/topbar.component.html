<header class="topbar">
    <div class="topbar__brand" aria-label="DABubble">
        <img
            class="topbar__logo"
            src="assets/pictures/Logo.svg"
            alt="DABubble Logo"
        />
        <span class="topbar__name">DABubble</span>
    </div>

    <div class="topbar__search">
        <input
            type="text"
            placeholder="Devspace durchsuchen"
            [value]="searchTerm"
            (input)="onSearchInput(($any($event.target)).value)"
            (blur)="onSearchBlur()"
            (focus)="onSearchInput(searchTerm)"
        />

        @if (showSearchResults) {
            <div class="search-results" (mousedown)="$event.preventDefault()">
                @if (channelResults.length) {
                    <section>
                        <h5>Channels</h5>
                        @for (channel of channelResults; track channel.id) {
                            <button
                                type="button"
                                (click)="navigateToChannel(channel.id)"
                            >
                                # {{ channel.name }}
                            </button>
                        }
                    </section>
                }

                @if (userResults.length) {
                    <section>
                        <h5>Benutzer</h5>
                        @for (user of userResults; track user.id) {
                            <button type="button" (click)="closeSearchResults()">
                                {{ user.name }} · {{ user.email }}
                            </button>
                        }
                    </section>
                }

                @if (messageResults.length) {
                    <section>
                        <h5>Nachrichten</h5>
                        @for (message of messageResults; track message.id) {
                            <button
                                type="button"
                                (click)="navigateToMessage(message.channelId)"
                            >
                                {{ message.text }}
                            </button>
                        }
                    </section>
                }
            </div>
        }
    </div>

    <div class="topbar__user">
        <span class="topbar__username">{{ displayName }}</span>
        <div class="topbar__avatar-wrap">
            @if (showAvatarImage && avatarUrl) {
                <img
                    class="topbar__avatar"
                    [src]="avatarUrl"
                    [alt]="displayName"
                    (error)="onAvatarError()"
                />
            } @else {
                <div class="topbar__avatar-fallback" [attr.aria-label]="displayName">
                    {{ initials }}
                </div>
            }
            <span class="status-dot" [ngClass]="presenceStatus"></span>
        </div>
        <button
            type="button"
            class="topbar__chevron"
            aria-label="User Menü öffnen"
            (click)="toggleUserMenu()"
        >
            ▾
        </button>

        @if (showUserMenu) {
            <div class="user-menu">
                <div class="user-menu__backdrop" (click)="closeUserMenu()"></div>
                <div class="user-menu__content">
                    <button
                        type="button"
                        class="user-menu__item"
                        (click)="navigateToProfile()"
                    >
                        <span class="material-symbols-outlined">person</span>
                        <span>Profil</span>
                    </button>
                    <button
                        type="button"
                        class="user-menu__item"
                        (click)="logout()"
                    >
                        <span class="material-symbols-outlined">logout</span>
                        <span>Abmelden</span>
                    </button>
                </div>
            </div>
        }
    </div>
</header>

@if (showProfile) {
    <div class="profile-modal" (click)="closeProfile()">
        <div class="profile-modal__panel" (click)="$event.stopPropagation()">
            <app-show-profile (close)="closeProfile()"></app-show-profile>
        </div>
    </div>
}
